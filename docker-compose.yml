services:
  activemq:
    image: rmohr/activemq:${ACTIVEMQ_VERSION:-5.15.9}
    container_name: activemq-test
    ports:
      - "61616:61616"  # OpenWire
      - "61613:61613"  # STOMP
      - "8161:8161"    # Web Console
    environment:
      - ACTIVEMQ_MIN_MEMORY=512
      - ACTIVEMQ_MAX_MEMORY=2048
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8161/"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s
    restart: unless-stopped

  # Alternative: Apache ActiveMQ Classic (newer versions) for compatibility testing
  # Uncomment and use 'docker compose up activemq-apache' to test with Apache's official image
  # activemq-apache:
  #   image: apache/activemq-classic:5.18.7
  #   container_name: activemq-test-apache
  #   ports:
  #     - "61616:61616"
  #     - "61613:61613"
  #     - "8161:8161"
  #   environment:
  #     - ACTIVEMQ_OPTS=-Xms512m -Xmx2g
  #   healthcheck:
  #     test: ["CMD", "curl", "-f", "http://localhost:8161/admin"]
  #     interval: 10s
  #     timeout: 5s
  #     retries: 5
  #     start_period: 30s
